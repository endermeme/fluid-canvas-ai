<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vòng Quay May Mắn</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      min-height: 100vh;
      background-color: #1e2130;
      font-family: 'Arial', sans-serif;
      color: white;
    }
    
    .wheel-container {
      position: relative;
      width: 400px;
      height: 400px;
      margin: 0 auto;
    }
    
    canvas {
      display: block;
      margin: 0 auto;
      border-radius: 50%;
      border: 10px solid #f9c74f;
      box-shadow: 0 0 0 10px rgba(249, 199, 79, 0.3), 0 10px 20px rgba(0, 0, 0, 0.5);
      transition: transform 5s cubic-bezier(0.17, 0.67, 0.21, 0.99);
    }
    
    .marker {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-top: 30px solid #e63946;
      z-index: 2;
      filter: drop-shadow(0px 5px 5px rgba(0, 0, 0, 0.3));
    }
    
    .spin-button {
      margin-top: 40px;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: bold;
      background-color: #f94144;
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }
    
    .spin-button:hover {
      background-color: #e63946;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.4);
    }
    
    .result {
      margin-top: 20px;
      padding: 15px 25px;
      border-radius: 50px;
      font-size: 20px;
      font-weight: bold;
      color: white;
      text-align: center;
      min-height: 30px;
      transition: all 0.3s ease;
      display: inline-block;
    }
    
    .controls {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    
    .title {
      font-size: 32px;
      font-weight: bold;
      color: white;
      text-align: center;
      margin-bottom: 20px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .subtitle {
      font-size: 16px;
      color: #aaa;
      text-align: center;
      margin-bottom: 40px;
    }
  </style>
</head>
<body>
  <div class="title">Vòng Quay May Mắn</div>
  <div class="subtitle">Nhấn nút Quay để xem kết quả</div>
  
  <div class="wheel-container">
    <div class="marker"></div>
    <canvas id="wheelCanvas" width="400" height="400"></canvas>
  </div>
  
  <div class="controls">
    <button class="spin-button" id="spinBtn">QUAY NGAY</button>
    <div class="result" id="result"></div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Dữ liệu các phần của vòng quay - sắp xếp lại để giống với hình ảnh
      const segments = [
        { text: 'Đỏ', color: '#f94144' },         // Đỏ
        { text: 'Cam', color: '#f3722c' },        // Cam
        { text: 'Cam đậm', color: '#c65102' },    // Cam đậm 
        { text: 'Xanh ngọc', color: '#2a9d8f' },  // Xanh ngọc
        { text: 'Xanh da trời', color: '#4ea8de' },// Xanh da trời
        { text: 'Tím', color: '#9d4edd' },        // Tím
        { text: 'Xanh lá', color: '#43aa8b' },    // Xanh lá
        { text: 'Vàng', color: '#f9c74f' }        // Vàng
      ];
      
      // Thiết lập canvas
      const canvas = document.getElementById('wheelCanvas');
      const ctx = canvas.getContext('2d');
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = canvas.width / 2.3; // Để đảm bảo vòng quay vừa với canvas và border
      
      // Vẽ vòng quay
      drawWheel();
      
      // Xử lý sự kiện quay
      let canSpin = true;
      let currentRotation = 0;
      let wheelRotation = 0;
      
      document.getElementById('spinBtn').addEventListener('click', function() {
        if (!canSpin) return;
        
        canSpin = false;
        const resultDisplay = document.getElementById('result');
        resultDisplay.textContent = '';
        resultDisplay.style.backgroundColor = 'transparent';
        
        // Thêm hiệu ứng âm thanh (có thể thêm)
        // const audio = new Audio('spin.mp3');
        // audio.play();
        
        // Random số góc quay từ 4 đến 8 vòng quay đầy đủ
        const rotationAngle = 1440 + Math.floor(Math.random() * 1440);
        wheelRotation = rotationAngle;
        
        // Thiết lập animation
        let startTime = null;
        const animationDuration = 5000; // 5 giây
        
        function animateWheel(timestamp) {
          if (!startTime) startTime = timestamp;
          const elapsed = timestamp - startTime;
          
          // Tính toán góc quay hiện tại dựa trên thời gian đã trôi qua
          let currentProgress = elapsed / animationDuration;
          if (currentProgress > 1) currentProgress = 1;
          
          // Hàm easing để làm cho chuyển động trở nên tự nhiên hơn
          const easeOut = (t) => {
            return 1 - Math.pow(1 - t, 3);
          };
          
          // Áp dụng góc quay
          const currentAngle = easeOut(currentProgress) * wheelRotation;
          currentRotation = currentAngle;
          
          // Vẽ lại vòng quay với góc quay mới
          drawWheel();
          
          // Tiếp tục animation nếu chưa hoàn thành
          if (currentProgress < 1) {
            requestAnimationFrame(animateWheel);
          } else {
            // Hiển thị kết quả sau khi quay xong
            const segmentAngle = 360 / segments.length;
            const normalizedAngle = currentRotation % 360;
            const segmentIndex = Math.floor((360 - normalizedAngle) / segmentAngle) % segments.length;
            const winningSegment = segments[segmentIndex];
            
            resultDisplay.textContent = `Kết quả: ${winningSegment.text}`;
            resultDisplay.style.backgroundColor = winningSegment.color;
            resultDisplay.style.boxShadow = `0 4px 8px rgba(0,0,0,0.3)`;
            
            // Hiệu ứng bounce cho kết quả
            resultDisplay.animate(
              [
                { transform: 'scale(0.5)', opacity: 0 },
                { transform: 'scale(1.1)' },
                { transform: 'scale(1)' }
              ],
              {
                duration: 500,
                easing: 'ease-out'
              }
            );
            
            canSpin = true;
          }
        }
        
        requestAnimationFrame(animateWheel);
      });
      
      function drawWheel() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        
        // Di chuyển đến tâm của canvas và áp dụng góc quay
        ctx.translate(centerX, centerY);
        ctx.rotate(degreesToRadians(currentRotation));
        
        const segmentAngle = 360 / segments.length;
        
        // Vẽ từng phân đoạn
        segments.forEach((segment, index) => {
          const angle = degreesToRadians(index * segmentAngle);
          
          // Bắt đầu vẽ phân đoạn
          ctx.beginPath();
          ctx.moveTo(0, 0); // Tâm vòng quay
          ctx.arc(0, 0, radius, angle, angle + degreesToRadians(segmentAngle));
          ctx.lineTo(0, 0);
          ctx.fillStyle = segment.color;
          ctx.fill();
          ctx.closePath();
          
          // Thêm border cho phân đoạn
          ctx.beginPath();
          ctx.moveTo(0, 0);
          ctx.arc(0, 0, radius, angle, angle + degreesToRadians(segmentAngle));
          ctx.lineTo(0, 0);
          ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
          ctx.lineWidth = 1;
          ctx.stroke();
          ctx.closePath();
          
          // Thêm text cho phân đoạn
          ctx.save();
          ctx.rotate(angle + degreesToRadians(segmentAngle / 2));
          ctx.textAlign = 'center';
          ctx.fillStyle = 'white';
          ctx.font = 'bold 16px Arial';
          ctx.fillText(segment.text, radius * 0.7, 0);
          
          // Thêm họa tiết trang trí (dải sáng) cho mỗi phân đoạn
          ctx.save();
          ctx.translate(radius * 0.3, 0);
          ctx.beginPath();
          ctx.moveTo(0, -5);
          ctx.lineTo(20, 0);
          ctx.lineTo(0, 5);
          ctx.closePath();
          ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
          ctx.fill();
          ctx.restore();
          
          ctx.restore();
        });
        
        // Vẽ viền tròn ngoài cùng
        ctx.beginPath();
        ctx.arc(0, 0, radius, 0, Math.PI * 2);
        ctx.strokeStyle = '#f9c74f';
        ctx.lineWidth = 3;
        ctx.stroke();
        ctx.closePath();
        
        // Vẽ tâm vòng quay
        ctx.beginPath();
        ctx.arc(0, 0, 15, 0, Math.PI * 2);
        ctx.fillStyle = '#f9c74f';
        ctx.fill();
        ctx.closePath();
        
        // Vẽ vòng tròn nhỏ hơn ở tâm
        ctx.beginPath();
        ctx.arc(0, 0, 8, 0, Math.PI * 2);
        ctx.fillStyle = '#e63946';
        ctx.fill();
        ctx.closePath();
        
        ctx.restore();
      }
      
      function degreesToRadians(degrees) {
        return degrees * Math.PI / 180;
      }
    });
  </script>
</body>
</html> 